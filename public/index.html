<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.Io Tutorials</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        #message_container {
            display: flex;
            flex-direction: column;
            height: 400px; /* İhtiyacınıza göre ayarlayın */
            overflow-y: auto;
            padding: 10px;
        }
        .message {
            margin-bottom: 10px;
        }
        .message-you {
        align-self: flex-start;
        display: flex;
        flex-direction: column;
    }
    
   
   
    .message-me {
        align-self: flex-end;
        display: flex;
        flex-direction: column;
    }
    

    </style>
</head>

<body>
    <div id="auth"
        class="flex flex-col items-start p-4 gap-2 rounded-md w-[450px] h-[200px] m-auto bg-slate-600 text-white">
        <div class="">Nikcname daxil edin</div>
        <input class="rounded-md bg-white border-none px-1 text-slate-600" id="nickName" placeholder="John Doe" />
        <button onclick="logIn()" type="submit" class="rounded-md w-12 p-1 border-none bg-slate-700">
            Enter
        </button>
    </div>
    <div class=" flex flex-col ">
        <div class="rounded-t-[20px] p-8 mx-[30%] bg-indigo-600 text-white mt-5 text-2xl ">Chatbox</div>
        <div class="border border-sky-600  p-8 mx-[30%] rounded-b-lg ">

            <div id="message_container" class="message_container">
                <!-- Mesajlar buraya eklenecek -->
            </div>

            <div class="mt-7 flex">
                <input type="text" id="message"
                    class=" block w-full rounded-l-lg border-0 py-6 pl-7 pr-20 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                    placeholder="Message...">
                <button onclick="sendMessage()" class="bg-indigo-500 w-20 rounded-r-[15px]">
                    Send
                </button>

            </div>
        </div>


    </div>
    <script>
        const socket = io('/');
        let nickName = "";
        socket.on('connect', () => {
            console.log("connect is successful");
        })
        socket.on('auth_success', (message) => {
            document.getElementById("auth").style.display = "none";
        });
        
        socket.on('new_message', (data) => {
            const messageContainer = document.getElementById('message_container');
            let messageHtml = '';

            if (data.nickName === nickName) {
                // Kullanıcının kendi mesajı
                messageHtml = `
                    <div class="message message-me">
                        <h7 class="text-sm flex flex-row-reverse">Me</h7>
                        <p class="border  p-5 rounded-r-[28px] rounded-bl-[30px] bg-indigo-500 w-48 text-white ms-1">${data.message}</p>
                        <h6 class="text-sm flex flex-row-reverse">12:00 AM</h6>
                    </div>
                `;
            } else {
                // Diğer kullanıcının mesajı
                messageHtml = `
                    <div class="message message-you">
                        <h7 class="name text-sm">${data.nickName}</h7>
                        <p class="border  p-5 rounded-r-[28px] rounded-bl-[30px] bg-indigo-500 w-48 text-white ms-1">${data.message}</p>
                        <h6 class="text-sm">12:00 AM</h6>
                    </div>
                `;
            }

            messageContainer.innerHTML += messageHtml;
            messageContainer.scrollTop = messageContainer.scrollHeight; // Mesajların görünmesini sağla
        });

        function logIn() {
            nickName = document.getElementById("nickName").value;
            if (nickName.length >= 2) {
                socket.emit("auth", nickName);
            } else {
                alert("Nickname must be at least 2 characters long.");
            }
            document.getElementById("auth").style.display = "none";
        }

        function sendMessage() {
            let message = document.getElementById("message");
            if (message.value.trim().length >= 3) {
                socket.emit("message", message.value);

                const messageContainer = document.getElementById('message_container');
                let messageHtml = `
                    <div class="message message-me">
                        <h7 class="text-sm flex flex-row-reverse">Me</h7>
                        <p class="border  p-5 rounded-r-[28px] rounded-bl-[30px] bg-indigo-500 w-48 text-white ms-1">${message.value}</p>
                        <h6 class="text-sm flex flex-row-reverse">12:00 AM</h6>
                    </div>
                `;
                messageContainer.innerHTML += messageHtml;
                messageContainer.scrollTop = messageContainer.scrollHeight; // Mesajların görünmesini sağla

                message.value = "";
            } else {
                alert("3 herfden az mesaj yazma!");
            }
        }
    </script>



</body>

</html>